{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/shai/9april2021/components/form.tsx\";\n\n/**\n * Copyright 2020 Vercel Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { useState } from 'react';\nimport cn from 'classnames';\nimport useConfData from '@lib/hooks/use-conf-data';\nimport { useRouter } from 'next/router';\nimport FormError from '@lib/form-error';\nimport LoadingDots from './loading-dots';\nimport styleUtils from './utils.module.css';\nimport styles from './form.module.css';\nimport useEmailQueryParam from '@lib/hooks/use-email-query-param';\nimport { register } from '@lib/user-api';\nexport default function Form({\n  sharePage\n}) {\n  const {\n    0: email,\n    1: setEmail\n  } = useState('');\n  const {\n    0: errorMsg,\n    1: setErrorMsg\n  } = useState('');\n  const {\n    0: errorTryAgain,\n    1: setErrorTryAgain\n  } = useState(false);\n  const {\n    0: focused,\n    1: setFocused\n  } = useState(false);\n  const {\n    0: formState,\n    1: setFormState\n  } = useState('default');\n  const {\n    setPageState,\n    setUserData\n  } = useConfData();\n  const router = useRouter();\n  useEmailQueryParam('email', setEmail);\n  return formState === 'error' ? /*#__PURE__*/_jsxDEV(\"div\", {\n    className: cn(styles.form, {\n      [styles['share-page']]: sharePage\n    }),\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: styles['form-row'],\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: cn(styles['input-label'], styles.error),\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: cn(styles.input, styles['input-text']),\n          children: errorMsg\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 52,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"button\",\n          className: cn(styles.submit, styles.register, styles.error),\n          onClick: () => {\n            setFormState('default');\n            setErrorTryAgain(true);\n          },\n          children: \"Try Again\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 53,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 51,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 50,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 45,\n    columnNumber: 5\n  }, this) : /*#__PURE__*/_jsxDEV(\"form\", {\n    className: cn(styles.form, {\n      [styles['share-page']]: sharePage,\n      [styleUtils.appear]: !errorTryAgain,\n      [styleUtils['appear-fifth']]: !errorTryAgain && !sharePage,\n      [styleUtils['appear-third']]: !errorTryAgain && sharePage\n    }),\n    onSubmit: e => {\n      if (formState === 'default') {\n        setFormState('loading');\n        register(email).then(async res => {\n          if (!res.ok) {\n            throw new FormError(res);\n          }\n\n          const data = await res.json();\n          const params = {\n            id: data.id,\n            ticketNumber: data.ticketNumber,\n            name: data.name,\n            username: data.username\n          };\n\n          if (sharePage) {\n            const queryString = Object.keys(params).map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key] || '')}`).join('&');\n            router.replace(`/?${queryString}`, '/');\n          } else {\n            setUserData(params);\n            setPageState('ticket');\n          }\n        }).catch(async err => {\n          let message = 'Error! Please try again.';\n\n          if (err instanceof FormError) {\n            var _res$headers$get, _data$error;\n\n            const {\n              res\n            } = err;\n            const data = ((_res$headers$get = res.headers.get('Content-Type')) === null || _res$headers$get === void 0 ? void 0 : _res$headers$get.includes('application/json')) ? await res.json() : null;\n\n            if ((data === null || data === void 0 ? void 0 : (_data$error = data.error) === null || _data$error === void 0 ? void 0 : _data$error.code) === 'bad_email') {\n              message = 'Please enter a valid email';\n            }\n          }\n\n          setErrorMsg(message);\n          setFormState('error');\n        });\n      } else {\n        setFormState('default');\n      }\n\n      e.preventDefault();\n    },\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: styles['form-row'],\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"email-input-field\",\n        className: cn(styles['input-label'], {\n          [styles.focused]: focused\n        }),\n        children: /*#__PURE__*/_jsxDEV(\"input\", {\n          className: styles.input,\n          autoComplete: \"off\",\n          type: \"email\",\n          id: \"email-input-field\",\n          value: email,\n          onChange: e => setEmail(e.target.value),\n          onFocus: () => setFocused(true),\n          onBlur: () => setFocused(false),\n          placeholder: \"Enter email to register free\",\n          \"aria-label\": \"Your email address\",\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        className: cn(styles.submit, styles.register, styles[formState]),\n        disabled: formState === 'loading',\n        children: formState === 'loading' ? /*#__PURE__*/_jsxDEV(LoadingDots, {\n          size: 4\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 38\n        }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: \"Register\"\n        }, void 0, false)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 67,\n    columnNumber: 5\n  }, this);\n}","map":{"version":3,"sources":["/Users/shai/9april2021/components/form.tsx"],"names":["useState","cn","useConfData","useRouter","FormError","LoadingDots","styleUtils","styles","useEmailQueryParam","register","Form","sharePage","email","setEmail","errorMsg","setErrorMsg","errorTryAgain","setErrorTryAgain","focused","setFocused","formState","setFormState","setPageState","setUserData","router","form","error","input","submit","appear","e","then","res","ok","data","json","params","id","ticketNumber","name","username","queryString","Object","keys","map","key","encodeURIComponent","join","replace","catch","err","message","headers","get","includes","code","preventDefault","target","value"],"mappings":"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","sourcesContent":["/**\n * Copyright 2020 Vercel Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState } from 'react';\nimport cn from 'classnames';\nimport useConfData from '@lib/hooks/use-conf-data';\nimport { useRouter } from 'next/router';\nimport FormError from '@lib/form-error';\nimport LoadingDots from './loading-dots';\nimport styleUtils from './utils.module.css';\nimport styles from './form.module.css';\nimport useEmailQueryParam from '@lib/hooks/use-email-query-param';\nimport { register } from '@lib/user-api';\n\ntype FormState = 'default' | 'loading' | 'error';\n\ntype Props = {\n  sharePage?: boolean;\n};\n\nexport default function Form({ sharePage }: Props) {\n  const [email, setEmail] = useState('');\n  const [errorMsg, setErrorMsg] = useState('');\n  const [errorTryAgain, setErrorTryAgain] = useState(false);\n  const [focused, setFocused] = useState(false);\n  const [formState, setFormState] = useState<FormState>('default');\n  const { setPageState, setUserData } = useConfData();\n  const router = useRouter();\n  useEmailQueryParam('email', setEmail);\n\n  return formState === 'error' ? (\n    <div\n      className={cn(styles.form, {\n        [styles['share-page']]: sharePage\n      })}\n    >\n      <div className={styles['form-row']}>\n        <div className={cn(styles['input-label'], styles.error)}>\n          <div className={cn(styles.input, styles['input-text'])}>{errorMsg}</div>\n          <button\n            type=\"button\"\n            className={cn(styles.submit, styles.register, styles.error)}\n            onClick={() => {\n              setFormState('default');\n              setErrorTryAgain(true);\n            }}\n          >\n            Try Again\n          </button>\n        </div>\n      </div>\n    </div>\n  ) : (\n    <form\n      className={cn(styles.form, {\n        [styles['share-page']]: sharePage,\n        [styleUtils.appear]: !errorTryAgain,\n        [styleUtils['appear-fifth']]: !errorTryAgain && !sharePage,\n        [styleUtils['appear-third']]: !errorTryAgain && sharePage\n      })}\n      onSubmit={e => {\n        if (formState === 'default') {\n          setFormState('loading');\n          register(email)\n            .then(async res => {\n              if (!res.ok) {\n                throw new FormError(res);\n              }\n\n              const data = await res.json();\n              const params = {\n                id: data.id,\n                ticketNumber: data.ticketNumber,\n                name: data.name,\n                username: data.username\n              };\n\n              if (sharePage) {\n                const queryString = Object.keys(params)\n                  .map(\n                    key =>\n                      `${encodeURIComponent(key)}=${encodeURIComponent(\n                        params[key as keyof typeof params] || ''\n                      )}`\n                  )\n                  .join('&');\n                router.replace(`/?${queryString}`, '/');\n              } else {\n                setUserData(params);\n                setPageState('ticket');\n              }\n            })\n            .catch(async err => {\n              let message = 'Error! Please try again.';\n\n              if (err instanceof FormError) {\n                const { res } = err;\n                const data = res.headers.get('Content-Type')?.includes('application/json')\n                  ? await res.json()\n                  : null;\n\n                if (data?.error?.code === 'bad_email') {\n                  message = 'Please enter a valid email';\n                }\n              }\n\n              setErrorMsg(message);\n              setFormState('error');\n            });\n        } else {\n          setFormState('default');\n        }\n        e.preventDefault();\n      }}\n    >\n      <div className={styles['form-row']}>\n        <label\n          htmlFor=\"email-input-field\"\n          className={cn(styles['input-label'], {\n            [styles.focused]: focused\n          })}\n        >\n          <input\n            className={styles.input}\n            autoComplete=\"off\"\n            type=\"email\"\n            id=\"email-input-field\"\n            value={email}\n            onChange={e => setEmail(e.target.value)}\n            onFocus={() => setFocused(true)}\n            onBlur={() => setFocused(false)}\n            placeholder=\"Enter email to register free\"\n            aria-label=\"Your email address\"\n            required\n          />\n        </label>\n        <button\n          type=\"submit\"\n          className={cn(styles.submit, styles.register, styles[formState])}\n          disabled={formState === 'loading'}\n        >\n          {formState === 'loading' ? <LoadingDots size={4} /> : <>Register</>}\n        </button>\n      </div>\n    </form>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}